/*
_____/\\\\\\\\\________/\\\\\\\\\\\____/\\\\\\\\\\\\\\\____/\\\\\\\\\___________/\\\\\______        
 ___/\\\\\\\\\\\\\____/\\\/////////\\\_\///////\\\/////___/\\\///////\\\_______/\\\///\\\____       
  __/\\\/////////\\\__\//\\\______\///________\/\\\_______\/\\\_____\/\\\_____/\\\/__\///\\\__      
   _\/\\\_______\/\\\___\////\\\_______________\/\\\_______\/\\\\\\\\\\\/_____/\\\______\//\\\_     
    _\/\\\\\\\\\\\\\\\______\////\\\____________\/\\\_______\/\\\//////\\\____\/\\\_______\/\\\_    
     _\/\\\/////////\\\_________\////\\\_________\/\\\_______\/\\\____\//\\\___\//\\\______/\\\__   
      _\/\\\_______\/\\\__/\\\______\//\\\________\/\\\_______\/\\\_____\//\\\___\///\\\__/\\\____  
       _\/\\\_______\/\\\_\///\\\\\\\\\\\/_________\/\\\_______\/\\\______\//\\\____\///\\\\\/_____ 
        _\///________\///____\///////////___________\///________\///________\///_______\/////_______
                                
     /___.`--.____ .--. ____.--(
                       .'_.- (    ) -._'.
                     .'.'    |'..'|    '.'.
              .-.  .' /'--.__|____|__.--'\ '.  .-.
             (O).)-| |  \    |    |    /  | |-(.(O)
              `-'  '-'-._'-./      \.-'_.-'-'  `-'
                 _ | |   '-.________.-'   | | _
              .' _ | |     |   __   |     | | _ '.
             / .' ''.|     | /    \ |     |.'' '. \
             | |( )| '.    ||      ||    .' |( )| |
             \ '._.'   '.  | \    / |  .'   '._.' /
              '.__ ______'.|__'--'__|.'______ __.'
             .'_.-|         |------|         |-._'.
            //\\  |         |--::--|         |  //\\
           //  \\ |         |--::--|         | //  \\
          //    \\|        /|--::--|\        |//    \\
         / '._.-'/|_______/ |--::--| \_______|\`-._.' \
        / __..--'        /__|--::--|__\        `--..__ \
       / /               '-.|--::--|.-'               \ \
      / /                   |--::--|                   \ \
     / /                    |--::--|                    \ \
 _.-'  `-._                 _..||.._                  _.-` '-._
'--..__..--'               '-.____.-'                '--..__..-'

*/

#include "config.h"

//*******************************************//
//           External Declarations           //
//*******************************************//

// LoRa Radio Functions
extern void initRadio();
extern void receiveAndReply();

// BNO055 Sensor Functions
extern void initBNO055();
extern void logBNO055Data();

// SD Card Functions
extern void logDataToSD();
extern void setupSDCard();

// Alitemter Functions
extern void initMPL3115A2();
extern void logMPL3115A2Data();


//*******************************************//
//                 Setup                     //
//*******************************************//

void setup() {
    // Initialize Serial Communication
    Serial.begin(115200);
    while (!Serial) {
        delay(1); // Wait for Serial Connection
    }
    Serial.println("Initialization on Core 0!");

    // Initialize I2C and SPI
    Wire.begin();  // Use default I2C pins
    SPI.begin();   // Use default SPI pins

    // Initialize Sensor and SD Card
    initBNO055();
    setupSDCard();
    initMPL3115A2();
}

//*******************************************//
//                 Loop                      //
//*******************************************//

void loop() {
    // Log Data from BNO055 Sensor
    logBNO055Data();
    
    // Log Data to SD Card
    logDataToSD();
    logMPL3115A2Data();

}

//*******************************************//
//                Setup1                     //
//*******************************************//

void setup1() {
    // Initialize LoRa Radio
    initRadio();
}

//*******************************************//
//                Loop1                      //
//*******************************************//

void loop1() {
    // Handle LoRa Communication
    receiveAndReply();
}
